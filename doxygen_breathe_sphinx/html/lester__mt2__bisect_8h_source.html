<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: /home/ppe/r/rsclark/gambitvenv/doc_stuff/gambit_2.2_sphinx/ColliderBit/include/gambit/ColliderBit/lester_mt2_bisect.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_e33afb057d1d4a1228c8c4d05c43b8ff.html">ColliderBit</a></li><li class="navelem"><a class="el" href="dir_86971f7a3e033a44fdd79643f3070191.html">include</a></li><li class="navelem"><a class="el" href="dir_23cb615865cdef5cc6f1be63d4618712.html">gambit</a></li><li class="navelem"><a class="el" href="dir_18844a962068c5ffc5567e7b65967bca.html">ColliderBit</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">lester_mt2_bisect.h</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">/*</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *  Copyright 2014, Christopher Lester, Univeristy of Cambridge</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> *</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> *  version 5: arXiv:1411.4312v5</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> *    * made more portable by removal of use of __FILE__ and __LINE__ macros in debug statement</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> *    * made fewer demands on poor C++ compilers (ROOT5/CINT) by removal of certain inline statements</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> *    * added this changelog!</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> * </span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> *  version 4: arXiv:1411.4312v4</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> *    * added copyright information</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> *</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> *  version 3: arXiv:1411.4312v3</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> *    * added option to turn on/off deci-sectioning</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> *    * made code slightly slower for readability gain</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> *</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> *  version 2: arXiv:1411.4312v2</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"> *    * no changes w.r.t. version 1</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"> *</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"> *  version 1: arXiv:1411.4312v1</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment"> *    * initial public release</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment"> *</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment"> *  This file will let you calculate MT2 or Asymmetric MT2 relatively easily.</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"> *  An example showing how to do so, may be found below this copyright message.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment"> *</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment"> *  (Note that this is a low-level library.  Various wrappers exist around</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment"> *   it to allow easier interfacing to ROOT or ATLAS code.)</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment"> *</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment"> *   If you use this implementation, please cite:</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment"> *</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment"> *   http://arxiv.org/abs/1411.4312</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment"> *</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment"> *   as the paper documenting this particular implementation.</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="comment"> *</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="comment"> *   You might also need to cite:</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="comment"> *</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="comment"> *   http://arxiv.org/abs/hep-ph/9906349 </span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="comment"> *   Journal reference: Phys.Lett.B463:99-103,1999</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="comment"> *   DOI: 10.1016/S0370-2693(99)00945-4</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="comment"> *</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="comment"> *   as the paper defining MT2. </span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment"> *</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment"> * Here is an example of it&#39;s use:</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="comment"> </span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment"></span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">double mVisA = 10; // mass of visible object on side A.  Must be &gt;=0.</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment">double pxA = 20; // x momentum of visible object on side A.</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment">double pyA = 30; // y momentum of visible object on side A.</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment"></span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">double mVisB = 10; // mass of visible object on side B.  Must be &gt;=0.</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">double pxB = -20; // x momentum of visible object on side B.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">double pyB = -30; // y momentum of visible object on side B.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment"></span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">double pxMiss = -5; // x component of missing transverse momentum.</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">double pyMiss = -5; // y component of missing transverse momentum.</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="comment"></span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="comment">double chiA = 4; // hypothesised mass of invisible on side A.  Must be &gt;=0.</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="comment">double chiB = 7; // hypothesised mass of invisible on side B.  Must be &gt;=0.</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment"></span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">double desiredPrecisionOnMt2 = 0; // Must be &gt;=0.  If 0 alg aims for machine precision.  if &gt;0, MT2 computed to supplied absolute precision.</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment"></span> </div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">// asymm_mt2_lester_bisect::disableCopyrightMessage();</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="comment"></span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="comment">double MT2 =  asymm_mt2_lester_bisect::get_mT2(</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">           mVisA, pxA, pyA,</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment">           mVisB, pxB, pyB,</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="comment">           pxMiss, pyMiss,</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">           chiA, chiB,</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">           desiredPrecisionOnMt2);</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="comment"></span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment"> */</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#ifndef LESTER_TESTWHETHERELLIPSESAREDISJOINT_H</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="preprocessor">#define LESTER_TESTWHETHERELLIPSESAREDISJOINT_H</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="preprocessor">#include &lt;cmath&gt;</span> <span class="comment">// for fabs( ... )</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="comment">/*</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment"> * The</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="comment"> *</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="comment"> *             bool ellipsesAreDisjoint(const EllipseParams &amp; e1, const EllipseParams &amp; e2);</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment"> *</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment"> * function determines whether two ellipses (not both singular) are disjoint.</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment"> * Ellipses are assumed to be solid objects with a filled interior.</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment"> * They are disjoint it no part of their interiors overlap.</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment"> * Singular (in this context) is defined below.</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="comment"> *</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment"> * It uses the method of:</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment"></span> </div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">Computer Aided Geometric Design 23 (2006) 324–350</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">A new approach to characterizing the relative position of two ellipses depending on one parameter</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="comment">Fernando Etayo 1,3, Laureano Gonzalez-Vega ∗,2,3, Natalia del Rio 3</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">Departamento de Matematicas, Estadistica y Computacion, Universidad de Cantabria, Spain</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">Received 15 September 2004; received in revised form 2 November 2005; accepted 10 January 2006 Available online 28 February 2006</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment"></span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">pointed out to me by Gary B. Huges and Mohcine Chraibi authors of</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment"></span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="comment"> Comput Visual Sci (2012) 15:291–301 DOI 10.1007/s00791-013-0214-3</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="comment"> Calculating ellipse overlap areas Gary B. Hughes · Mohcine Chraibi</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span><span class="comment"></span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="comment"> * Note:</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span><span class="comment"> *</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment"> * Though the paper above talks only about ellipses, from playing with some test cases, I (CGL) have conjectured that the algorithm actually works well even if the conics are parabolas provided that the axx&gt;0&amp;&amp;ayy&gt;0 test is reduced to axx&gt;=0&amp;&amp;ayy&gt;=0&amp;&amp;axx*ayy!=0 ... which is true is good news for the similicity of the MT2 calculator ... as the MT2 calculator will not need to distinguish these two possibilities.  In a private communication between me (CGL) and the  authors of Computer Aided Geometric Design 23 (2006) 324–350, the authors have indicated that it is not unreasonable to believe that the code does indeed work on the parabolica cases too.  This algorithm relies on that generalisation, which may be the subject of a paper (to appear) from Etayo and Gonzalez-Vega.</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment"> *</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment"> *</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="comment"> * Definition: an ellipse is defined with respect to cartesian co-ordinates (x,y) by an equation of the form;</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="comment"> *</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment"> * xVec^T A xVec = 0                 (1)</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment"> *</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment"> * where xVec is a columnar three vec containing (x,y,1) and where A is a symmetric matrix having elements:</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment"> *</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment"> *       [ axx axy ax  ]</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment"> *   A = [ axy ayy ay  ]</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment"> *       [ ax  ay  a   ].</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment"> *</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment"> * Therfore the ellipse equation would look like:</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment"> *</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment"> * axx x^2 + 2 axy x y + ayy y^2 + 2 ax x + 2 ay y + a = 0.</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment"> *</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment"> * Note that this parametrisation has one parameter too many ... the &quot;A&quot;-matrix can be multiplied by a non-zero constant, and the ellipse is not changed.</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment"> * Etayo et al&#39;s implementation REQUIRES that axx and ayy be strictly positive.</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment"> * The implementation herein doesn&#39;t quite enforce that. The implementation herein allows axx or ayy to be non-negative .... and it is left to the user to ensure that axx and ayy are not exactly zero.</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="comment"> * Note also that (1) is general enough to contain all conic sections, so it is left to the user to ensure that only values of A consistent</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment"> * with (non-singluar) ellipses are fed into the program below.  For our purposes, an ellipse is &quot;singular&quot; iff coeffLamPow3 (see below) is zero.</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment"> */</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="keyword">namespace </span>Lester {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="structLester_1_1EllipseParams.html">  130</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  <span class="comment">// Constructor for non-degenerate ellipses:</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>  <span class="comment">/*</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">   * Ellipse is represented algebraically by:</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">   * c_xx x^2 + 2 c_xy x y + c_yy y^2 + 2 c_x x + 2 c_y y + c = 0.</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment">   */</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>  <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a>(</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_xx2,</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_yy2,</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_xy2,</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_x2,</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_y2,</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c2) :</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    c_xx(c_xx2),</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    c_yy(c_yy2),</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    c_xy(c_xy2),</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    c_x(c_x2),</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    c_y(c_y2),</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    c(c2) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>     <span class="comment">//Etayo et al REQUIRE that c_xx and c_yy are non-negative, so:</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>     <span class="keywordflow">if</span> (c_xx&lt;0 || c_yy&lt;0) {</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>       <span class="keywordflow">throw</span> <span class="stringliteral">&quot;precondition violation&quot;</span>;</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>     }</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    setDet();</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>  <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a>() {</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>  }</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  <span class="keywordtype">void</span> setDet() {</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    det = (2.0*c_x*c_xy*c_y + c*c_xx*c_yy - c_yy*c_x*c_x - c*c_xy*c_xy - c_xx*c_y*c_y) ;</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>  }</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>  <span class="comment">// Consstructor for degenerate ellipse (i.e. a &quot;dot&quot; at (x0,y0) ).</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a>(</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> x0,</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> y0) :</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    c_xx(1),</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    c_yy(1),</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    c_xy(0),</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    c_x(-x0),</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    c_y(-y0),</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    c(x0*x0 + y0*y0),</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    det(0) {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  }</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  <span class="keywordtype">double</span> lesterFactor(<span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e2)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e1 = *<span class="keyword">this</span>;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ans  = e1.c_xx*e1.c_yy*e2.c + 2.0*e1.c_xy*e1.c_y*e2.c_x - 2.0*e1.c_x*e1.c_yy*e2.c_x + e1.c*e1.c_yy*e2.c_xx - 2.0*e1.c*e1.c_xy*e2.c_xy + 2.0*e1.c_x*e1.c_y*e2.c_xy + 2.0*e1.c_x*e1.c_xy*e2.c_y - 2.0*e1.c_xx*e1.c_y*e2.c_y + e1.c*e1.c_xx*e2.c_yy - e2.c_yy*(e1.c_x*e1.c_x) - e2.c*(e1.c_xy*e1.c_xy) - e2.c_xx*(e1.c_y*e1.c_y);</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordflow">return</span> ans;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  }</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  <span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; other)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="keywordflow">return</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>      c_xx == other.c_xx &amp;&amp;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>      c_yy == other.c_yy &amp;&amp;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>      c_xy == other.c_xy &amp;&amp;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>      c_x == other.c_x &amp;&amp;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>      c_y == other.c_y &amp;&amp;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>      c == other.c;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>  }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  <span class="comment">// Data</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <span class="keywordtype">double</span> c_xx;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>  <span class="keywordtype">double</span> c_yy;</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  <span class="keywordtype">double</span> c_xy; <span class="comment">// note factor of 2 above</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  <span class="keywordtype">double</span> c_x;  <span class="comment">// note factor of 2 above</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>  <span class="keywordtype">double</span> c_y;  <span class="comment">// note factor of 2 above</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>  <span class="keywordtype">double</span> c;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>  <span class="keywordtype">double</span> det; <span class="comment">// The determinant of the 3x3 conic matrix</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>};</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">// This is the interface: users should call this function:</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="keywordtype">bool</span> ellipsesAreDisjoint(<span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e1, <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e2);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="comment">// This is an implementation thing: users should not call it:</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="keywordtype">bool</span> __private_ellipsesAreDisjoint(<span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow3, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow2, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow1, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow0);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="keywordtype">bool</span> ellipsesAreDisjoint(<span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e1, <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">EllipseParams</a> &amp; e2) {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>  <span class="comment">/* We want to construct the polynomial &quot;Det(lamdba A + B)&quot; where A and B are the 3x3 matrices associated with e1 and e2, and we want to get that</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">  polynomial in the form lambda^3 + a lambda^2 + b lambda + c.</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment"></span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment"></span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">  Note that by default we will not have unity as the coefficient of the lambda^3 term, however the redundancy in the parametrisation of A and B allows us to scale the whole ply until the first term does have a unit coefficient.</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">  */</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>  <span class="keywordflow">if</span> (e1==e2) {</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// Probably won&#39;t catch many cases, but may as well have it here.</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>  }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span> </div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  <span class="comment">// first get unscaled terms:</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow3 = e1.det; <span class="comment">// Note that this is the determinant of the symmetric matrix associated with e1.</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow2 = e1.lesterFactor(e2);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow1 = e2.lesterFactor(e1);</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow0 = e2.det; <span class="comment">// Note that this is the determinant of the symmetric matrix associated with e2.</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>  <span class="comment">// Since question is &quot;symmetric&quot; and since we need to dovide by coeffLamPow3 ... do this the way round that involves dividing by the largest number:</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>  <span class="keywordflow">if</span> (fabs(coeffLamPow3) &gt;= fabs(coeffLamPow0)) {</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="keywordflow">return</span> __private_ellipsesAreDisjoint(coeffLamPow3, coeffLamPow2, coeffLamPow1, coeffLamPow0); <span class="comment">// normal order</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="keywordflow">return</span> __private_ellipsesAreDisjoint(coeffLamPow0, coeffLamPow1, coeffLamPow2, coeffLamPow3); <span class="comment">// reversed order</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>}</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="keywordtype">bool</span> __private_ellipsesAreDisjoint(<span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow3, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow2, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow1, <span class="keyword">const</span> <span class="keywordtype">double</span> coeffLamPow0) {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <span class="comment">// precondition of being called:</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  <span class="comment">//assert(fabs(coeffLamPow3)&gt;=fabs(coeffLamPow0));</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>  <span class="keywordflow">if</span>(coeffLamPow3==0) {</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="comment">// The ellipses were singular in some way.</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="comment">// Cannot determine whether they are overlapping or not.</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="keywordflow">throw</span> 1;</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  }</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span> </div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>  <span class="comment">// now scale terms to monomial form:</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> a = coeffLamPow2 / coeffLamPow3;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> b = coeffLamPow1 / coeffLamPow3;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> c = coeffLamPow0 / coeffLamPow3;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="preprocessor">#ifdef LESTER_DEEP_FIDDLE</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  {</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> thing1 = -3.0*b + a*a;</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> thing2 = -27.0*c*c + 18.0*c*a*b + a*a*b*b - 4.0*a*a*a*c - 4.0*b*b*b;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    std::cout </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      &lt;&lt; (thing1&gt;0) &lt;&lt; <span class="stringliteral">&quot; &amp;&amp; &quot;</span> &lt;&lt; (thing2&gt;0) &lt;&lt; <span class="stringliteral">&quot; &amp;&amp; [[ &quot;</span> &lt;&lt; (a&gt;=0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; (3.0*a*c + b*a*a - 4.0*b*b&lt;0)  &lt;&lt; <span class="stringliteral">&quot; ] or &quot;</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      &lt;&lt; <span class="stringliteral">&quot;[ &quot;</span> &lt;&lt; (a&lt; 0)   &lt;&lt; <span class="stringliteral">&quot; ] =(&quot;</span>&lt;&lt; ((a &gt;= 0 <span class="comment">/*&amp;&amp; thing1 &gt; 0*/</span> &amp;&amp; 3.0*a*c + b*a*a - 4.0*b*b&lt; 0 /*&amp;&amp; thing2 &gt; 0*/) ||</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                                 (a &lt;  0 <span class="comment">/*&amp;&amp; thing1 &gt; 0*/</span>                                 <span class="comment">/*&amp;&amp; thing2 &gt; 0*/</span>)) &lt;&lt; <span class="stringliteral">&quot;)] &quot;</span> &lt;&lt; (</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>          ( (a &gt;= 0 &amp;&amp; thing1 &gt; 0 &amp;&amp; 3.0*a*c + b*a*a - 4.0*b*b&lt; 0 &amp;&amp; thing2 &gt; 0) ||</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                                 (a &lt;  0 &amp;&amp; thing1 &gt; 0                                 &amp;&amp; thing2 &gt; 0))</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>          </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>          ) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  }</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  <span class="comment">// Use the main result of the above paper:</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> thing1 = -3.0*b + a*a;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="keywordflow">if</span> (thing1&lt;=0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> thing2 = -27.0*c*c + 18.0*c*a*b + a*a*b*b - 4.0*a*a*a*c - 4.0*b*b*b;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  <span class="keywordflow">if</span> (thing2&lt;=0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>  <span class="comment">// ans true means ellipses are disjoint:</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> ans = ( (a &gt;= 0 <span class="comment">/*&amp;&amp; thing1 &gt; 0*/</span> &amp;&amp; 3.0*a*c + b*a*a - 4.0*b*b&lt; 0 <span class="comment">/*&amp;&amp; thing2 &gt; 0*/</span>) ||</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                     (a &lt;  0 /*&amp;&amp; thing1 &gt; 0*/                                 <span class="comment">/*&amp;&amp; thing2 &gt; 0*/</span>));</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>}</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>}</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="preprocessor">#ifndef ASYMM_MT2_BISECT_H</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="preprocessor">#define ASYMM_MT2_BISECT_H</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno"><a class="line" href="classasymm__mt2__lester__bisect.html">  295</a></span><span class="keyword">class </span><a class="code hl_class" href="classasymm__mt2__lester__bisect.html">asymm_mt2_lester_bisect</a> {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> MT2_ERROR=-1;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>  <span class="keyword">static</span> <span class="keywordtype">double</span> get_mT2( <span class="comment">// returns asymmetric mT2 (which is &gt;=0), or returns a negative number (such as MT2_ERROR) in the case of an error.</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mVis1, <span class="keyword">const</span> <span class="keywordtype">double</span> pxVis1, <span class="keyword">const</span> <span class="keywordtype">double</span> pyVis1,</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mVis2, <span class="keyword">const</span> <span class="keywordtype">double</span> pxVis2, <span class="keyword">const</span> <span class="keywordtype">double</span> pyVis2,</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> pxMiss, <span class="keyword">const</span> <span class="keywordtype">double</span> pyMiss,</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mInvis1, <span class="keyword">const</span> <span class="keywordtype">double</span> mInvis2,</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> desiredPrecisionOnMT2=0, <span class="comment">// This must be non-negative.  If set to zero (default) MT2 will be calculated to the highest precision available on the machine (or as close to that as the algorithm permits).  If set to a positive value, MT2 (note that is MT2, not its square) will be calculated to within +- desiredPrecisionOnMT2. Note that by requesting precision of +- 0.01 GeV on an MT2 value of 100 GeV can result in speedups of a factor of ...</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> useDeciSectionsInitially=<span class="keyword">true</span> <span class="comment">// If true, interval is cut at the 10% point until first acceptance, which gives factor 3 increase in speed calculating kinematic min, but 3% slowdown for events in the bulk.  Is on (true) by default, but can be turned off by setting to false.</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  ) {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mT2_Sq = get_mT2_Sq(</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                            mVis1, pxVis1, pyVis1,</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                            mVis2, pxVis2, pyVis2,</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                            pxMiss,pyMiss,</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                            mInvis1, mInvis2,</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                            desiredPrecisionOnMT2,</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                            useDeciSectionsInitially);</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordflow">if</span> (mT2_Sq==MT2_ERROR) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>      <span class="keywordflow">return</span> MT2_ERROR;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    }</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <span class="keywordflow">return</span> sqrt(mT2_Sq);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>  }</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>  </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>  <span class="keyword">static</span> <span class="keywordtype">void</span> disableCopyrightMessage(<span class="keyword">const</span> <span class="keywordtype">bool</span> printIfFirst=<span class="keyword">false</span>) {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="keyword">static</span> <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="keywordflow">if</span> (first &amp;&amp; printIfFirst) {</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    std::cout </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>      &lt;&lt; <span class="stringliteral">&quot;#=========================================================\n&quot;</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>      &lt;&lt; <span class="stringliteral">&quot;# To disable this message, place a call to \n&quot;</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>      &lt;&lt; <span class="stringliteral">&quot;# \n&quot;</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>      &lt;&lt; <span class="stringliteral">&quot;#     asymm_mt2_lester_bisect::disableCopyrightMessage();\n&quot;</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>      &lt;&lt; <span class="stringliteral">&quot;# \n&quot;</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>      &lt;&lt; <span class="stringliteral">&quot;# somewhere before you begin to calculate your MT2 values.\n&quot;</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>      &lt;&lt; <span class="stringliteral">&quot;#=========================================================\n&quot;</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>      &lt;&lt; <span class="stringliteral">&quot;# You are calculating symmetric or asymmetric MT2 using\n&quot;</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>      &lt;&lt; <span class="stringliteral">&quot;# the implementation defined in:\n&quot;</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>      &lt;&lt; <span class="stringliteral">&quot;# \n&quot;</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>      &lt;&lt; <span class="stringliteral">&quot;#     http://arxiv.org/abs/1411.4312\n&quot;</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>      &lt;&lt; <span class="stringliteral">&quot;# \n&quot;</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>      &lt;&lt; <span class="stringliteral">&quot;# Please cite the paper above if you use the MT2 values\n&quot;</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>      &lt;&lt; <span class="stringliteral">&quot;# for a scholarly purpose. For the variable MT2 itself,\n&quot;</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>      &lt;&lt; <span class="stringliteral">&quot;# please also cite:\n&quot;</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>      &lt;&lt; <span class="stringliteral">&quot;# \n&quot;</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>      &lt;&lt; <span class="stringliteral">&quot;#     http://arxiv.org/abs/hep-ph/9906349\n&quot;</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>      &lt;&lt; <span class="stringliteral">&quot;#=========================================================\n&quot;</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>      &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span> &lt;&lt; std::flush;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    }</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    first = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>  }</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  <span class="keyword">static</span> <span class="keywordtype">double</span> get_mT2_Sq( <span class="comment">// returns square of asymmetric mT2 (which is &gt;=0), or returns a negative number (such as MT2_ERROR) in the case of an error.</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mVis1, <span class="keyword">const</span> <span class="keywordtype">double</span> pxVis1, <span class="keyword">const</span> <span class="keywordtype">double</span> pyVis1,</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mVis2, <span class="keyword">const</span> <span class="keywordtype">double</span> pxVis2, <span class="keyword">const</span> <span class="keywordtype">double</span> pyVis2,</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> pxMiss, <span class="keyword">const</span> <span class="keywordtype">double</span> pyMiss,</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mInvis1, <span class="keyword">const</span> <span class="keywordtype">double</span> mInvis2,</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> desiredPrecisionOnMT2=0, <span class="comment">// This must be non-negative.  If set to zero (default) MT2 will be calculated to the highest precision available on the machine (or as close to that as the algorithm permits).  If set to a positive value, MT2 (note that is MT2, not its square) will be calculated to within +- desiredPrecisionOnMT2. Note that by requesting precision of +- 0.01 GeV on an MT2 value of 100 GeV can resJult in speedups of a factor of ..</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> useDeciSectionsInitially=<span class="keyword">true</span> <span class="comment">// If true, interval is cut at the 10% point until first acceptance, which gives factor 3 increase in speed calculating kinematic min, but 3% slowdown for events in the bulk.  Is on (true) by default, but can be turned off by setting to false.</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>      ) {</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    disableCopyrightMessage(<span class="keyword">true</span>); <span class="comment">// By supplying an argument to disable, we actually ask for the message to be printed, if printing is not already disabled.   This counterintuitive function naming is to avoid the need to introduce static variable initialisations ....</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> m1Min = mVis1+mInvis1; <span class="comment">// when parent has this mass, ellipse 1 has smallest physical size</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> m2Min = mVis2+mInvis2; <span class="comment">// when parent has this mass, ellipse 2 has smallest physical size</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="keywordflow">if</span> (m1Min&gt;m2Min) {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>      <span class="comment">// swap 1 and 2</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>      <span class="keywordflow">return</span> asymm_mt2_lester_bisect::get_mT2_Sq(</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>               mVis2, pxVis2, pyVis2,</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>               mVis1, pxVis1, pyVis1,</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>               pxMiss, pyMiss,</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>               mInvis2, mInvis1,</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>               desiredPrecisionOnMT2</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>             );</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    }</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="comment">// By now, we can be sure that m1Min &lt;= m2Min</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    assert(m1Min&lt;=m2Min);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mMin = m2Min; <span class="comment">// when parent has this mass, both ellipses are physical, and at least one has zero size.  Note that the name &quot;min&quot; expresses that it is the minimum potential parent mass we should consider, not that it is the min of m1Min and m2Min.  It is in fact the MAX of them!</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="comment">// TODO: What about rounding?  What about idiots who give us mVis values that have been computed from E^2-p^2 terms that are perilously close to zero, or perilously degenerate?</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> msSq = mVis1*mVis1;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> sx = pxVis1;</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> sy = pyVis1;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mpSq = mInvis1*mInvis1;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mtSq = mVis2*mVis2;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> tx = pxVis2;</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> ty = pyVis2;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mqSq = mInvis2*mInvis2;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> sSq = sx*sx + sy*sy;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> tSq = tx*tx + ty*ty;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> pMissSq = pxMiss*pxMiss + pyMiss*pyMiss;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> massSqSum = msSq + mtSq + mpSq + mqSq;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> scaleSq = (massSqSum + sSq + tSq + pMissSq)/8.0;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="comment">// #define LESTER_DBG 1</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    std::cout &lt;&lt;<span class="stringliteral">&quot;\nMOO &quot;</span>;</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">// Check for an easy MT2 zero, not because we think it will speed up many cases, but because it will allow us to, ever after, assume that scaleSq&gt;0.</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="keywordflow">if</span> (scaleSq==0) {</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    }</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> scale = sqrt(scaleSq);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="comment">// disjoint at mMin.  So find an mUpper at which they are not disjoint:</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keywordtype">double</span> mLower = mMin;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="keywordtype">double</span> mUpper = mMin + scale; <span class="comment">// since scaleSq is guaranteed to be &gt;0 at this stage, the adition of scaleSq quarantees that mUpperSq is also &gt;0, so it can be exponentially grown (later) by doubling.</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> attempts=0;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxAttempts=10000;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>      ++attempts;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> mUpperSq = mUpper*mUpper;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a> &amp; side1=helper(mUpperSq, msSq, -sx, -sy, mpSq, 0,      0     ); <span class="comment">// see side1Coeffs in mathematica notebook</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a> &amp; side2=helper(mUpperSq, mtSq, +tx, +ty, mqSq, pxMiss, pyMiss); <span class="comment">// see side2Coeffs in mathematica notebook</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>      <span class="keywordtype">bool</span> disjoint;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        disjoint = Lester::ellipsesAreDisjoint(side1, side2);</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>      } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        <span class="keywordflow">return</span> MT2_ERROR;</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>      }</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span> </div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>      <span class="keywordflow">if</span> (!disjoint) {</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>      <span class="keywordflow">if</span> (attempts&gt;=maxAttempts) {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        std::cerr &lt;&lt; <span class="stringliteral">&quot;MT2 algorithm failed to find upper bound to MT2&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>        <span class="keywordflow">return</span> MT2_ERROR;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>      }</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span> </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      std::cout &lt;&lt; <span class="stringliteral">&quot; - &quot;</span>;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>      mUpper *= 2; <span class="comment">// grow mUpper exponentially</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    }</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">//const double tol = relativeTolerance * sqrt(scaleSq);</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="comment">// Now begin the bisection:</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordtype">bool</span> goLow = useDeciSectionsInitially;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <span class="keywordflow">while</span>(desiredPrecisionOnMT2&lt;=0 || mUpper-mLower&gt;desiredPrecisionOnMT2) {</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> trialM = ( goLow ?</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                              (mLower*15+mUpper)/16  <span class="comment">// bias low until evidence this is not a special case</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>                              :</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                              (mUpper + mLower)/2.0 <span class="comment">// bisect</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>                            ); <span class="comment">// worry about this not being between mUpperSq and mLowerSq! TODO</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>      <span class="keywordflow">if</span> (trialM&lt;=mLower || trialM&gt;=mUpper) {</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <span class="comment">// We reached a numerical precision limit:  the interval can no longer be bisected!</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        std::cout &lt;&lt; <span class="stringliteral">&quot; MACHINE_PREC &quot;</span> &lt;&lt; std::setprecision(10) &lt;&lt; mLower &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; trialM &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mUpper &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mUpper-mLower &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; desiredPrecisionOnMT2 &lt;&lt; std::endl;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>        <span class="keywordflow">return</span> trialM*trialM;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>      }</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> trialMSq = trialM * trialM;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a> &amp; side1 = helper(trialMSq, msSq, -sx, -sy, mpSq, 0,      0     ); <span class="comment">// see side1Coeffs in mathematica notebook</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a> &amp; side2 = helper(trialMSq, mtSq, +tx, +ty, mqSq, pxMiss, pyMiss); <span class="comment">// see side2Coeffs in mathematica notebook</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span> </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>      <span class="keywordflow">try</span> {</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> disjoint = Lester::ellipsesAreDisjoint(side1, side2);</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <span class="keywordflow">if</span> (disjoint) {</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>          mLower = trialM;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>          goLow = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;UP &quot;</span> ;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>          mUpper = trialM;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>          std::cout &lt;&lt; <span class="stringliteral">&quot;== &quot;</span>;</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        }</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>      } <span class="keywordflow">catch</span> (...) {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <span class="comment">// The test for ellipses being disjoint failed ... this means the ellipses became degenerate, which can only happen right at the bottom of the MT2 search range (subject to numerical precision).  So:</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        std::cout &lt;&lt; <span class="stringliteral">&quot; THROW &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        <span class="keywordflow">return</span> mLower*mLower;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>      }</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    }</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> mAns = (mLower+mUpper)/2.0;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="preprocessor">#ifdef LESTER_DBG</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    std::cout &lt;&lt; <span class="stringliteral">&quot; USER_PREC &quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="keywordflow">return</span> mAns*mAns;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>  };</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>  <span class="keyword">static</span> <span class="keywordtype">double</span> lestermax(<span class="keyword">const</span> <span class="keywordtype">double</span> x, <span class="keyword">const</span> <span class="keywordtype">double</span> y) {</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <span class="keywordflow">return</span> (x&gt;y)?x:y;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>  }</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a> helper(<span class="keyword">const</span> <span class="keywordtype">double</span> mSq, <span class="comment">// The test parent-mass value (squared)</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>       <span class="keyword">const</span> <span class="keywordtype">double</span> mtSq, <span class="keyword">const</span> <span class="keywordtype">double</span> tx, <span class="keyword">const</span> <span class="keywordtype">double</span> ty, <span class="comment">// The visible particle transverse momentum</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>       <span class="keyword">const</span> <span class="keywordtype">double</span> mqSq, <span class="comment">// The mass of the invisible particle</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>       <span class="keyword">const</span> <span class="keywordtype">double</span> pxmiss, <span class="keyword">const</span> <span class="keywordtype">double</span> pymiss</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>             ) {</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> txSq = tx*tx;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> tySq = ty*ty;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> pxmissSq = pxmiss*pxmiss;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> pymissSq = pymiss*pymiss;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_xx = +4.0* mtSq + 4.0* tySq;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_yy = +4.0* mtSq + 4.0* txSq;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_xy = -4.0* tx*ty;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_x  = -4.0* mtSq*pxmiss - 2.0* mqSq*tx + 2.0* mSq*tx - 2.0* mtSq*tx  +</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>               4.0* pymiss*tx*ty - 4.0* pxmiss*tySq;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c_y  = -4.0* mtSq*pymiss - 4.0* pymiss*txSq - 2.0* mqSq*ty + 2.0* mSq*ty - 2.0* mtSq*ty +</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>               4.0* pxmiss*tx*ty;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> c =   - mqSq*mqSq + 2*mqSq*mSq - mSq*mSq + 2*mqSq*mtSq + 2*mSq*mtSq - mtSq*mtSq +</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>                4.0* mtSq*pxmissSq + 4.0* mtSq*pymissSq + 4.0* mqSq*pxmiss*tx -</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                4.0* mSq*pxmiss*tx + 4.0* mtSq*pxmiss*tx + 4.0* mqSq*txSq +</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>                4.0* pymissSq*txSq + 4.0* mqSq*pymiss*ty - 4.0* mSq*pymiss*ty +</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                4.0* mtSq*pymiss*ty - 8.0* pxmiss*pymiss*tx*ty + 4.0* mqSq*tySq +</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                4.0* pxmissSq*tySq;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keywordflow">return</span> <a class="code hl_struct" href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a>(c_xx, c_yy, c_xy, c_x, c_y, c);</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>  }</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>};</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="keywordtype">void</span> myversion(){</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>  std::cout &lt;&lt; <span class="stringliteral">&quot;Version is : 2014_11_13&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>}</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span><span class="keywordtype">double</span> MT(<span class="keywordtype">double</span> px1, <span class="keywordtype">double</span> px2, <span class="keywordtype">double</span> py1, <span class="keywordtype">double</span> py2, <span class="keywordtype">double</span> m1 , <span class="keywordtype">double</span> m2){</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  <span class="keywordtype">double</span> E1 = sqrt(px1*px1+py1*py1+m1*m1);</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>  <span class="keywordtype">double</span> E2 = sqrt(px2*px2+py2*py2+m2*m2);</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>  <span class="keywordtype">double</span> Msq = (E1+E2)*(E1+E2)-(px1+px2)*(px1+px2)-(py1+py2)*(py1+py2);</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>  <span class="keywordflow">if</span> (Msq &lt; 0) Msq = 0;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>  <span class="keywordflow">return</span> sqrt(Msq);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>}</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>std::pair &lt;double,double&gt;  ben_findsols(<span class="keywordtype">double</span> MT2, <span class="keywordtype">double</span> px, <span class="keywordtype">double</span> py, <span class="keywordtype">double</span> visM, <span class="keywordtype">double</span> Ma, <span class="keywordtype">double</span> pxb, <span class="keywordtype">double</span> pyb, <span class="keywordtype">double</span> metx, <span class="keywordtype">double</span> mety, <span class="keywordtype">double</span> visMb, <span class="keywordtype">double</span> Mb){</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>  <span class="comment">//Visible particle (px,py,visM)                                                                                                                  </span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>  std::pair &lt;double,double&gt; sols;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>  <span class="comment">//Find the minimizing points given MT2                                                                                                           </span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="comment"></span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>  <span class="keywordtype">double</span> Pt = sqrt(px*px+py*py);</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>  <span class="keywordtype">double</span> E = sqrt(Pt*Pt+visM*visM);</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>  <span class="keywordtype">double</span> M = MT2;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>  <span class="keywordtype">double</span> E2 = E*E;</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>  <span class="keywordtype">double</span> M2 = M*M;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>  <span class="keywordtype">double</span> M4 = M2*M2;</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>  <span class="keywordtype">double</span> Ma2 = Ma*Ma;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>  <span class="keywordtype">double</span> Ma4 = Ma2*Ma2;</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>  <span class="keywordtype">double</span> px2 = px*px;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>  <span class="keywordtype">double</span> py2 = py*py;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>  <span class="keywordtype">double</span> px4 = px2*px2;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>  <span class="keywordtype">double</span> py4 = py2*py2;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>  <span class="keywordtype">double</span> py3 = py2*py;</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>  <span class="keywordtype">double</span> E4 = E2*E2;</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  <span class="keywordtype">double</span> TermA = E2*px-M2*px+Ma2*px-px2*px-px*py2;</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  <span class="keywordtype">double</span> TermB = -2.*px*py;</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  <span class="keywordtype">double</span> TermSqy0 = E4*E2-2.*E4*M2-2.*E4*Ma2-2.*E4*px2-2.*E4*py2+E2*M4-2.*E2*M2*Ma2+2.*E2*M2*px2+2.*E2*M2*py2+E2*Ma4+2.*E2*Ma2*px2-2.*E2*Ma2*py2+E2*px4+2.*E2*px2*py2+E2*py4;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>  <span class="keywordtype">double</span> TermSqy1 = -4.*E4*py+4.*E2*M2*py-4.*E2*Ma2*py+4.*E2*px2*py+4.*E2*py3;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>  <span class="keywordtype">double</span> TermSqy2 = -4.*E4+4.*E2*px2+4.*E2*py2;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>  <span class="comment">//First, determine the range.                                                                                                                   </span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>  <span class="keywordtype">double</span> myx = 0.;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>  <span class="keywordtype">double</span> myy = 0.;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>  <span class="keywordflow">if</span> (TermSqy1*TermSqy1-4.*TermSqy0*TermSqy2 &lt; 0){</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">//unbalanced                                                                                                                                 </span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>  }</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>  <span class="keywordflow">else</span>{</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <span class="keywordtype">double</span> sol1 = (-TermSqy1 - sqrt(TermSqy1*TermSqy1-4.*TermSqy0*TermSqy2))/(2.*TermSqy2);</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordtype">double</span> sol2 = (-TermSqy1 + sqrt(TermSqy1*TermSqy1-4.*TermSqy0*TermSqy2))/(2.*TermSqy2);</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    <span class="keywordtype">double</span> low = sol1;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>    <span class="keywordtype">double</span> high = sol2;</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <span class="keywordflow">if</span> (low &gt; high){</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>      low = sol2;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>      high = sol1;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    <span class="keywordtype">double</span> myclose = 99999999.;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    <span class="keywordflow">for</span> (<span class="keywordtype">double</span> metpy = low; metpy&lt;=high; metpy+=(high-low)/10000.){</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>      <span class="keywordtype">double</span> metpx = -(TermB*metpy+TermA-sqrt(TermSqy0+TermSqy1*metpy+TermSqy2*metpy*metpy))*0.5/(E2-px2);</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>      <span class="keywordtype">double</span> metpx2 = -(TermB*metpy+TermA+sqrt(TermSqy0+TermSqy1*metpy+TermSqy2*metpy*metpy))*0.5/(E2-px2);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>      <span class="keywordtype">double</span> mt1a = MT(px,metpx,py,metpy,visM,Ma);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>      <span class="keywordtype">double</span> mt1b = MT(px,metpx2,py,metpy,visM,Ma);</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>      <span class="keywordtype">double</span> metpxb = metx-metpx;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>      <span class="keywordtype">double</span> metpx2b = metx-metpx2;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>      <span class="keywordtype">double</span> mt2a = MT(pxb,metpxb,pyb,mety-metpy,visMb,Mb);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>      <span class="keywordtype">double</span> mt2b = MT(pxb,metpx2b,pyb,mety-metpy,visMb,Mb);</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>      <span class="keywordflow">if</span> (fabs(mt1a-mt2a) &lt; myclose){</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    myclose = fabs(mt1a-mt2a);</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    myy = metpy;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    myx = metpx;</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>      }</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>      <span class="keywordflow">if</span> (fabs(mt1b-mt2b) &lt; myclose){</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    myclose = fabs(mt1b-mt2b);</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    myy = metpy;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    myx = metpx2;</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>      }</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    }</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>  sols.first = myx;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  sols.second = myy;</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>  <span class="keywordflow">return</span> sols;</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>}</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span> </div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span> </div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span> </div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span> </div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span> </div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span> </div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span> </div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span> </div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="ttc" id="aclassasymm__mt2__lester__bisect_html"><div class="ttname"><a href="classasymm__mt2__lester__bisect.html">asymm_mt2_lester_bisect</a></div><div class="ttdef"><b>Definition:</b> lester_mt2_bisect.h:295</div></div>
<div class="ttc" id="astructLester_1_1EllipseParams_html"><div class="ttname"><a href="structLester_1_1EllipseParams.html">Lester::EllipseParams</a></div><div class="ttdef"><b>Definition:</b> lester_mt2_bisect.h:130</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
